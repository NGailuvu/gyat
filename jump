-- Reverse Flash Mirage (hold key to keep miraging)
-- LocalScript, taruh di StarterPlayerScripts

local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")

local player = Players.LocalPlayer
local miraging = false
local START_DISTANCE = 3    -- jarak awal
local MAX_DISTANCE = 12     -- jarak maksimal
local STEP = 0.2            -- seberapa cepat nambah jarak
local SPEED = 0.08          -- kecepatan mirage (semakin kecil semakin cepat)

local cloneModel = nil

-- ambil HumanoidRootPart
local function getRoot()
	local char = player.Character
	if not char then return end
	return char:FindFirstChild("HumanoidRootPart")
end

-- buat clone bayangan
local function makeClone()
	local char = player.Character
	if not char then return end
	local clone = char:Clone()
	for _, part in ipairs(clone:GetDescendants()) do
		if part:IsA("BasePart") then
			part.Anchored = true
			part.CanCollide = false
			part.Transparency = 0.3
		elseif part:IsA("Humanoid") then
			part:Destroy()
		end
	end
	clone.Parent = workspace
	return clone
end

-- loop mirage
local function startMirage()
	if miraging then return end
	miraging = true

	local root = getRoot()
	if not root then return end

	cloneModel = makeClone()
	if not cloneModel then
		miraging = false
		return
	end

	local toggle = true
	local currentDistance = START_DISTANCE

	while miraging and root and cloneModel do
		-- jarak bertambah seiring waktu
		if currentDistance < MAX_DISTANCE then
			currentDistance = math.min(currentDistance + STEP, MAX_DISTANCE)
		end

		if toggle then
			cloneModel:SetPrimaryPartCFrame(root.CFrame * CFrame.new(currentDistance, 0, 0))
		else
			cloneModel:SetPrimaryPartCFrame(root.CFrame * CFrame.new(-currentDistance, 0, 0))
		end

		toggle = not toggle
		task.wait(SPEED)
	end

	-- setelah lepas tombol, hapus clone
	if cloneModel then
		cloneModel:Destroy()
		cloneModel = nil
	end
end

-- stop mirage
local function stopMirage()
	miraging = false
end

-- input handler
UIS.InputBegan:Connect(function(input, gpe)
	if gpe then return end
	if input.KeyCode == Enum.KeyCode.C then
		startMirage()
	end
end)

UIS.InputEnded:Connect(function(input, gpe)
	if input.KeyCode == Enum.KeyCode.C then
		stopMirage()
	end
end)
